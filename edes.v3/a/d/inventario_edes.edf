[Title]Inventario de ficheros eDes
[DBTable]
[DBOrder]
[Format],M,M,M
[ColsOp],+,+,+
[Fields]
Extensión|ext|N|T|10||M||=|
Ficheros|file|+|T|20||M|||
Lineas|lineas|+|T|20||M|||
Carácteres|byts|+|T|20||M|||
[DBSql]l
if( WINDOW_OS ) eMessage('SOLO SISTEMA Linux/Unix','HSE');
$uDimFile = array( 'php', 'gs', 'inc', 'js', 'htm', 'html', 'css', 'ini',  'edf','gdf','ldf','fdf','sdf','lst' );
$DimNoDir = explode(",", "_tmp,temp,_no,sess,.vscode,_bak_");
$DimUltimoDir = explode(",", "tinymce");
$usuCursor = array();
$uDim = array();
$uDimTmp = array();
$uOtrasExt = array();
$uDimDir = array();
WCFile('../../edes.v3', $uDimFile, $uDim, $uOtrasExt);
foreach( $uDim as $key => $value ) $uDimTmp[] = $key.'|'.$value[2].'|'.$value[0].'|'.$value[1];
sort( $uDimTmp );
for( $n=0; $n<count($uDimTmp); $n++ ) $usuCursor[] = explode('|',$uDimTmp[$n]);
$uDimTmp = array();
foreach( $uOtrasExt as $key => $value ) $uDimTmp[] = $key.'|'.$value[0].'|'.$value[1];
sort( $uDimTmp );
$uOtrasExt = array();
for( $n=0; $n<count($uDimTmp); $n++ ) $uOtrasExt[] = explode('|',$uDimTmp[$n]);
$uDimTmp = array();
foreach( $uDimDir as $key => $value ) $uDimTmp[] = $key.'|'.$value;
sort( $uDimTmp );
$uDimDir = array();
for( $n=0; $n<count($uDimTmp); $n++ ) $uDimDir[] = explode('|',$uDimTmp[$n]);
function WCFile( $dorg, $uDimFile, &$uDim, &$uOtrasExt ){
global $uDimDir, $DimNoDir, $DimUltimoDir;
$di = opendir( $dorg );
$uDimDir[$dorg] = 0;
while( $file=readdir( $di ) ){
if( ($file!=".") && ($file!="..") ){
if( is_dir("{$dorg}/{$file}") ){
if( mb_substr($file,0,7)=="tinymce" || in_array("{$dorg}/{$file}", $DimNoDir) || in_array($file, $DimUltimoDir) ) continue;
WCFile( "{$dorg}/{$file}", $uDimFile, $uDim, $uOtrasExt );
}else{
$uDimDir[$dorg]++;
$ext = mb_substr($file, mb_strrpos($file,'.')+1);
if( in_array( $ext, $uDimFile ) ){
$ext = mb_strtoupper($ext);
exec( "wc -c -l {$dorg}/{$file}", $uDimSalida );
for( $n=0; $n<count($uDimSalida); $n++ ){
$uDimSalida[$n] = trim($uDimSalida[$n]);
while( mb_substr_count($uDimSalida[$n],'  ')>0 ){
$uDimSalida[$n] = str_replace( '  ',' ',$uDimSalida[$n]);
}
$tmp = explode(' ',$uDimSalida[$n]);
if( $tmp[2]=="{$dorg}/{$file}" ){
$uDim[$ext][0] += $tmp[0]*1;
$uDim[$ext][1] += $tmp[1]*1;
$uDim[$ext][2]++;
}
}
}else{
$ext = mb_strtoupper($ext);
$uOtrasExt[$ext][0] += filesize( "{$dorg}/{$file}" );
$uOtrasExt[$ext][1]++;
}
}
}
}
closedir( $di );
}
[PHPEnd]l
echo '<center><br>';
$tf = 0;
$tc = 0;
echo '<table class="BROWSE col_1r col_2r">';
echo '<tr><th>Otras extensiones<TH>Ficheros<TH>Carácteres';
echo "<COL class='Celda'><COL id=d class='Celda'><COL id=d class='Celda'>";
for( $n=0; $n<count($uOtrasExt); $n++ ){
echo '<tr><td>'.$uOtrasExt[$n][0];
echo '<td>'.eNumberFormat($uOtrasExt[$n][2]);
echo '<td>'.eNumberFormat($uOtrasExt[$n][1]);
$tf += $uOtrasExt[$n][2];
$tc += $uOtrasExt[$n][1];
}
echo '<tr class=PieLista><td id=d>'.eNumberFormat(count($uOtrasExt));
echo '<td id=d>'.eNumberFormat($tf);
echo '<td id=d>'.eNumberFormat($tc);
echo '</table>';
echo "<br><br>";
$tf2 = 0;
echo '<table class="BROWSE col_0r">';
echo '<tr><TH>Ficheros<th>Directorio';
echo "<COL id=d class='Celda'><COL class='Celda'>";
for( $n=0; $n<count($uDimDir); $n++ ){
echo '<tr><td>'.eNumberFormat($uDimDir[$n][1]).'<td>'.$uDimDir[$n][0];
$tf2 += $uDimDir[$n][1];
}
echo '<tr class=PieLista><td id=d>'.eNumberFormat($tf2);
echo '<td>'.eNumberFormat(count($uDimDir));
echo '</table>';
echo '</center>';
$php_errormsg = '';